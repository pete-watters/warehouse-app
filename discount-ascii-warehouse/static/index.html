<!DOCTYPE html>
<html>
    <head>
        <title>Discount Ascii Warehouse</title>
    </head>
    <body>
        <header>
            <h1>Discount Ascii Warehouse</h1>

            <p>Here you're sure to find a bargain on some of the finest ascii available to purchase. Be sure to peruse our selection of ascii faces in an exciting range of sizes and prices.</p>

            <p>But first, a word from our sponsors:</p>
            <script>document.write('<img class="ad" src="/ad/?r=' + Math.floor(Math.random()*1000) + '"/>');</script>
        </header>

        <section class="products">
            <div id="products-table"></div>
        </section>

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script>
            (function() {
                $.ajax({
                    type: "GET",
                    url: "/api/products",
                    dataType: "text",
                    success: function(resultData) {
                        var jsonString = "[" + resultData.replace(/\n/g, ",").slice(0, -1) + "]";
                        console.log($.parseJSON(jsonString));

                        var PRODUCT_JSON = $.parseJSON(jsonString);
                        // Draw GoogleTable
                        google.charts.load('current', {'packages':['table']});
                        google.charts.setOnLoadCallback(drawTable);


                        function drawTable() {

                            console.log("In chart " + PRODUCT_JSON);


                            var data = new google.visualization.DataTable(
                                    {
                                        cols: [
                                                {id: 'face', label: 'Face', type: 'string'},
                                                {id: 'price', label: 'Price', type: 'number'},
                                                {id: 'size', label: 'Size', type: 'number'},
                                                {id: 'date', label: 'Date', type: 'date'},
                                                {id: 'id', label: 'Product ID', type: 'string'}
                                        ]
                                    }
                            );

                            for(var i = 0; i < PRODUCT_JSON.length; i++){
                                data.addRow([ PRODUCT_JSON[i]["face"] ,  PRODUCT_JSON[i]["price"] , PRODUCT_JSON[i]["size"] , new Date(PRODUCT_JSON[i]["date"]), PRODUCT_JSON[i]["id"] ]);
                            }

//                            data.addRow();  // Add an empty row
//                            data.addRow(['Hermione', new Date(1999,0,1)]); // Add a row with a string and a date value.
//
//                            // Add a row with two cells, the second with a formatted value.
//                            data.addRow(['Hermione', {v: new Date(1999,0,1),f: 'January First, Nineteen ninety-nine'}]);
//



                            var table = new google.visualization.Table(document.getElementById('products-table'));

                            table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
                        }


                    },
                    error : function(jqXHR, textStatus, errorThrown) {
                        console.log(jqXHR + textStatus + errorThrown);
                    }
                });
            })();
        </script>

        </body>
</html>
